<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GA4 Practice Shop</title>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5PB2FBKT');</script>

<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; color:#333; }
header { background: #004aad; color:white; padding:15px; text-align:center; }
nav { text-align:center; margin:10px 0; }
nav a { margin:0 15px; text-decoration:none; color:#004aad; font-weight:bold; }

.step-form { max-width:400px; margin:30px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.step-form h2 { text-align:center; margin-bottom:15px; }
.step { display:none; }
.step.active { display:block; }
input[type="tel"] { width:100%; padding:10px; margin:10px 0; border:1px solid #ccc; border-radius:5px; font-size:16px; }
button { background:#004aad; color:white; border:none; padding:10px 15px; border-radius:5px; cursor:pointer; margin-top:10px; }
button:hover { background:#002f6c; }
</style>
</head>
<body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5PB2FBKT" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<header>Welcome to My Preetlytics</header>

<nav>
  <a href="index.html">Home</a>
  <a href="product.html">Products</a>
  <a href="checkout.html">Checkout</a>
  <a href="contact.html">Contact</a>
  <a href="blog.html">Blog</a>
</nav>

<!-- Phone Number Step Form -->
<div class="step-form">
  <h2>Enter Your Phone Number</h2>
  <div class="step active" id="step1">
    <label for="phone">Phone Number (10 digits)</label>
    <input type="tel" id="phone" maxlength="10" pattern="[0-9]{10}" placeholder="Enter 10 digit mobile number" required>
    <button onclick="submitPhone()">Next</button>
  </div>
</div>

<script>
// On page load, check if user_id exists in localStorage
window.onload = function() {
  const storedUserId = localStorage.getItem("user_id");
  if (storedUserId) {
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
      event: "userLoaded",
      user_id: storedUserId
    });
    console.log("Persisted user_id pushed:", storedUserId);
  }
};

function submitPhone() {
  const phone = document.getElementById("phone").value.trim();

  // Validate phone: must be 10 digits numeric
  if (!/^[0-9]{10}$/.test(phone)) {
    alert("Please enter a valid 10-digit numeric mobile number.");
    return;
  }

  // Check if user_id already exists for this phone number
  let users = JSON.parse(localStorage.getItem("users")) || {};
  let userId;

  if (users[phone]) {
    userId = users[phone]; // existing user_id
  } else {
    userId = "UID-" + Math.random().toString(36).substr(2,9);
    users[phone] = userId;
    localStorage.setItem("users", JSON.stringify(users));
  }

  // Save current user_id for persistence
  localStorage.setItem("user_id", userId);

  // Push to dataLayer
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    event: "userSubmitted",
    phone: phone,
    user_id: userId
  });

  console.log("Phone submitted:", phone, "Assigned user_id:", userId);
  alert("Phone saved! Your user_id: " + userId);
}
</script>

</body>
</html>
